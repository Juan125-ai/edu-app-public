<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generated Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .question-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .options-container {
            margin-left: 20px;
        }
        .option {
            margin: 10px 0;
        }
        .submit-btn {
            margin-top: 20px;
        }
        .correct-answer {
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1 class="text-center mb-4">Generated Quiz</h1>
        
        <div id="quiz-content">
            <!-- El cuestionario se insertará aquí dinámicamente -->
        </div>
        
        <button id="submit-btn" class="btn btn-primary submit-btn w-100">Submit Answers</button>
    </div>

    <script>
        // Parsear el contenido del quiz
        const quizContent = `{{ quiz }}`;
        
        function parseQuiz(quizText) {
            const questions = [];
            const questionRegex = /(Q\d+:.*?)(?=Q\d+:|$)/gs;
            
            let match;
            while ((match = questionRegex.exec(quizText)) !== null) {
                const questionBlock = match[0].trim();
                const questionObj = { text: '', options: [], answer: '' };
                
                // Extraer pregunta
                const questionMatch = questionBlock.match(/Q\d+:\s*(.+)/);
                if (questionMatch) questionObj.text = questionMatch[1].trim();
                
                // Extraer opciones
                const optionsMatch = questionBlock.match(/[A-D]\)\s*(.+)/g);
                if (optionsMatch) {
                    questionObj.options = optionsMatch.map(opt => 
                        opt.replace(/[A-D]\)\s*/, '').trim()
                    );
                }
                
                // Extraer respuesta
                const answerMatch = questionBlock.match(/Answer:\s*([A-D])/);
                if (answerMatch) questionObj.answer = answerMatch[1].trim();
                
                questions.push(questionObj);
            }
            
            return questions;
        }
        
        function renderQuiz(questions) {
            const container = document.getElementById('quiz-content');
            
            questions.forEach((q, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                questionCard.innerHTML = `
                    <h4>Question ${index + 1}: ${q.text}</h4>
                    <div class="options-container">
                        ${q.options.map((opt, i) => `
                            <div class="form-check option">
                                <input class="form-check-input" type="radio" 
                                       name="question${index}" id="q${index}opt${i}" 
                                       value="${String.fromCharCode(65 + i)}">
                                <label class="form-check-label" for="q${index}opt${i}">
                                    ${String.fromCharCode(65 + i)}) ${opt}
                                </label>
                            </div>
                        `).join('')}
                    </div>
                    <input type="hidden" class="correct-answer" value="${q.answer}">
                `;
                container.appendChild(questionCard);
            });
        }
        
        // Calcular resultados cuando se envía el cuestionario
        document.getElementById('submit-btn').addEventListener('click', function() {
            const questions = document.querySelectorAll('.question-card');
            let score = 0;
            const container = document.getElementById('quiz-content');
            
            questions.forEach((q, index) => {
                const selectedOption = q.querySelector(`input[name="question${index}"]:checked`);
                const correctAnswer = q.querySelector('.correct-answer').value;
                
                if (selectedOption && selectedOption.value === correctAnswer) {
                    score++;
                    q.style.backgroundColor = '#d4edda'; // Verde para respuesta correcta
                } else if (selectedOption) {
                    q.style.backgroundColor = '#f8d7da'; // Rojo para respuesta incorrecta
                } else {
                    q.style.backgroundColor = '#fff3cd'; // Amarillo para no contestada
                }
                
                // Resaltar la respuesta correcta
                const correctOption = q.querySelector(`input[value="${correctAnswer}"]`);
                if (correctOption) {
                    const label = correctOption.nextElementSibling;
                    label.innerHTML += ' <span class="correct-answer">(Correct Answer)</span>';
                }
            });
            
            // Mostrar resultado
            const resultDiv = document.createElement('div');
            resultDiv.className = 'alert alert-info mt-4';
            resultDiv.innerHTML = `
                <h4>Your Score: ${score}/${questions.length}</h4>
                <p>Percentage: ${Math.round((score / questions.length) * 100)}%</p>
            `;
            container.appendChild(resultDiv);
            
            // Deshabilitar botón de envío
            this.disabled = true;
        });
        
        // Inicializar el cuestionario
        const questions = parseQuiz(quizContent);
        if (questions.length > 0) {
            renderQuiz(questions);
        } else {
            document.getElementById('quiz-content').innerHTML = `
                <div class="alert alert-danger">
                    Could not generate quiz. Please try with a different video.
                </div>
            `;
            document.getElementById('submit-btn').style.display = 'none';
        }
    </script>
</body>
</html>